<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Gaia Raga</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
</head>
<script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
<script>
  if (window.netlifyIdentity) {
    window.netlifyIdentity.on('init', user => {
      if (!user) {
        window.netlifyIdentity.on('login', () => {
          document.location.href = '/admin/';
        });
      }
    });
    window.netlifyIdentity.init();
  }
</script>
<script>
const REPO = "irademos/gaia_raga";
const BRANCH = "main";

async function fetchFolder(path) {
  const url = `https://api.github.com/repos/${REPO}/contents/${path}?ref=${BRANCH}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error("Failed to fetch " + path);
  return res.json();
}

async function fetchFile(url) {
  const res = await fetch(url);
  return res.text();
}

function parseFrontmatter(md) {
  const match = md.match(/^---([\s\S]*?)---/);
  if (!match) return { body: md };
  const meta = {};
  match[1].split("\n").forEach(line => {
    const [key, ...rest] = line.split(":");
    if (!key || !rest.length) return;
    meta[key.trim()] = rest.join(":").trim();
  });
  return {
    meta,
    body: md.replace(match[0], "").trim()
  };
}

async function loadNews() {
  const container = document.getElementById("news-list");
  const files = await fetchFolder("content/posts");

  for (const file of files.reverse()) {
    const md = await fetchFile(file.download_url);
    const { meta, body } = parseFrontmatter(md);

    const article = document.createElement("article");
    article.innerHTML = `
      <h3>${meta.title || "Post"}</h3>
      <p>${body.slice(0, 160)}...</p>
    `;
    container.appendChild(article);
  }
}

async function loadTour() {
  const container = document.getElementById("tour-list");
  const files = await fetchFolder("content/tour");

  for (const file of files) {
    const md = await fetchFile(file.download_url);
    const { meta } = parseFrontmatter(md);

    const div = document.createElement("div");
    div.className = "tour-item";
    div.innerHTML = `
      <span>${new Date(meta.date).toLocaleDateString()}</span>
      <span>${meta.city || ""}</span>
      <span>${meta.venue || ""}</span>
      <a href="${meta.tickets || "#"}" class="ticket">Tickets</a>
    `;
    container.appendChild(div);
  }
}

loadNews();
loadTour();
</script>

<body>

  <!-- HERO -->
  <section class="hero">
    <div class="hero-overlay"></div>
    <div class="hero-content">
      <h1>Gaia Raga</h1>
      <p>New EP out now</p>
      <div class="hero-buttons">
        <a href="#listen" class="btn">Listen</a>
        <a href="#tour" class="btn ghost">Tour</a>
      </div>
    </div>
  </section>

  <!-- MUSIC -->
  <section id="listen" class="section">
    <h2>Music</h2>
    <div class="embed">
      <!-- Replace with Spotify/Bandcamp embed -->
      <iframe 
        src="https://open.spotify.com/embed/artist/6CVhMTeCTVK3SQzotfSegp"
        width="100%" 
        height="152"
        frameborder="0"
        allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture">
      </iframe>
    </div>
  </section>

  <!-- TOUR -->
  <section id="tour" class="section dark">
    <h2>Tour</h2>
    <div id="tour-list" class="tour-list"></div>
  </section>


  <!-- NEWS -->
  <section class="section">
    <h2>News</h2>
    <div id="news-list" class="news"></div>
  </section>


  <!-- FOOTER -->
  <footer>
    <div class="socials">
      <a href="#">Instagram</a>
      <a href="https://open.spotify.com/artist/6CVhMTeCTVK3SQzotfSegp">Spotify</a>
      <a href="#">YouTube</a>
      <a href="#">Email</a>
    </div>
    <p>Â© 2026 Band Name</p>
  </footer>

</body>
</html>
